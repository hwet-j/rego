<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link href="/css/plan_add.css" rel="stylesheet">
    <meta content="width=device-width, initial-scale=1" name="viewport">
    <!-- 제이쿼리 불러오기 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

    <!-- 폰트어썸 불러오기 -->
    <link crossorigin="anonymous" href="https://use.fontawesome.com/releases/v5.3.1/css/all.css"
          integrity="sha384-mzrmE5qonljUremFsqc01SB46JvROS7bZs3IO2EmfFsd15uHvIt+Y8vEf7N7fWAU"
          rel="stylesheet">

    <!-- XEIcon 폰트 불러오기 -->
    <link href="https://cdn.jsdelivr.net/npm/xeicon@2.3.3/xeicon.min.css" rel="stylesheet">




</head>

<body>
<script>
    $(document).ready(function () {
        $("#planForm").submit(function (event) {
            event.preventDefault(); // 기본 제출 동작 방지

            var formData = new FormData(this); // 현재 폼 데이터 가져오기

            $.ajax({
                type: "POST",
                url: "/plan/ajaxValid",
                data: formData,
                processData: false, // 중요: 데이터를 처리하지 않도록 설정
                contentType: false, // 중요: 컨텐츠 유형을 false로 설정
                success: function (data) {
                    console.log(data); // 응답 데이터 확인
                    if (data.isValid) {
                        // 유효성 검사 통과 시 페이지 이동 또는 다른 동작 수행
                        window.location.href = "/plan/detail?planId=" + data.planId;
                    } else {
                        // 유효성 검사 오류 메시지 표시
                        displayErrorMessages(data.fieldErrors);
                        console.log(data.fieldErrors);
                    }
                },
                error: function (xhr, status, error) {
                    console.error(error); // 오류 메시지 확인
                }
            });
        });
    });


    function displayErrorMessages(fieldErrors) {
        $(".error").text("");

        for (var fieldName in fieldErrors) {
            var errorMessage = fieldErrors[fieldName];
            var errorContainer = $("#" + fieldName + "Error");
            console.log(errorMessage);
            console.log(fieldName);
            errorContainer.text(errorMessage);
        }
    }

</script>


    <div class="background"></div>
    <div class="background2"></div>


    <div class="nav">

        <ul class="" style="list-style-type:none;">
            <li class="">
                <a class="logo" th:href="@{/}"><img src="/img/logo.png"
                                                    style="float: left; width: 63px; height: 58px; margin-left: 10px; background-repeat: no-repeat;"></a>

                <div class="nav-left"
                     style="float:left;   margin-left: 470px; margin-top: 19px;  font-size: 20px;  font-family: 'Roboto', sans-serif; font-weight: 500;">
                    <a class="" style="margin-right: 50px; color:#4F54B4;"
                       th:href="@{/}">HOME</a>
                    <a class="" style="margin-right: 50px; color:#4F54B4;"
                       th:href="@{/}">AIRPORT</a>
                    <a class="" style="margin-right: 50px; color:#4F54B4;"
                       th:href="@{/}">START PLAN</a>
                    <a class="" style="color:#4F54B4;"
                       th:href="@{/}">RECOMMEND</a>
                </div>

                <div class="nav-right"
                     style="float:right;    margin-right: 35px; margin-top: 27px;  font-size: 12px;  font-family: 'Roboto', sans-serif; font-weight: 600;">
                    <a class="" style="margin-right: 20px; color:#4F54B4;"
                       th:href="@{/question/list}">고객센터</a>
                    <a class="loginBtn" sec:authorize="isAnonymous()" style="margin-right: 20px; color:#4F54B4;"
                       th:href="@{/login}">로그인</a>
                    <a class="" sec:authorize="isAuthenticated()" style="margin-right: 20px; color:#4F54B4;"
                       th:href="@{/}">마이페이지</a>
                    <a class="" sec:authorize="isAuthenticated()" style="margin-right: 20px; color:#4F54B4;"
                       th:href="@{/logout}">로그아웃</a>
                    <a class="" sec:authorize="hasRole('ADMIN')" style="color:#4F54B4;"
                       th:href="@{/}">ADMIN</a>
                </div>
            </li>
        </ul>

    </div>

<div class="container">


    <div class="left-side">
        <div class="bbox">
            <h1 class="box">계획 생성하기</h1>
            <form data-aos="fade" id="planForm" method="post" action="/plan/ajaxValid">
                <div class="label-box">
                    <label class="input-label" for="search-type">검색 유형</label>
                    <div class="search-title">
                        <select class="form-control" id="search-type" name="type">
                            <option value="">미선택</option>
                            <option value="자유">자유</option>
                            <option value="힐링">힐링</option>
                            <option value="문화">문화</option>
                            <option value="쇼핑">쇼핑</option>
                            <option value="식도락">식도락</option>
                        </select>
                        <div class="error select-error" id="typeError"></div>
                    </div>
                </div>

                <div class="inquiry-con">
                    <input class="input-content" readonly id="userEmail" name="userEmail" type="hidden" th:value="${#strings.toLowerCase(#authentication.principal.username)}" th:readonly="readonly">

                    <div class="label-box" style="position: relative;">
                        <label class="input-label">여행제목</label>
                        <div class="title" for="content"></div>
                        <div class="input-container">
                            <input class="input-content" id="content" name="content" type="text">
                        </div>
                        <div class="error" id="contentError"></div>
                    </div>

                    <div class="label-box" style="position: relative;">
                        <label class="input-label">여행 시작일</label>
                        <input class="input-content" id="startDate" name="startDate" type="date">
                        <div class="error" id="startDateError"></div>
                    </div>

                    <div class="label-box" style="position: relative;">
                        <label class="input-label">여행 종료일</label>
                        <input class="input-content" id="endDate" name="endDate" type="date">
                        <div class="error" id="endDateError"></div>
                        <div class="error" id="endDateAfterStartDateError"></div>
                    </div>

                    <div class="label-box" style="position: relative;">
                        <label class="input-label">여행 인원</label>
                        <div class="title" for="numberOfPeople"></div>
                        <input class="input-content" id="numberOfPeople"  value="1" name="numberOfPeople" type="number">
                        <div class="error" id="numberOfPeopleError"></div>
                    </div>

<!--                    <span th:if="${#fields.hasErrors('endDateAfterStartDate')}" th:errors="*{endDateAfterStartDate}"></span>-->

                    <div class="label-box">
                        <span class="btn-container">
                            <button class="btn" type="submit" id="submitBtn">작성완료</button>
                        </span>
                    </div>
                </div>
            </form>

        </div>
    </div>


    <div class="right-side">
        <!-- 크기 조절을 위해 테스트 -->
        <div th:if="${flightInfo == null}">
            <img class="right-side-image" src="/img/side.png">
            <div class="start-btn"><a class="start-plan-btn" th:href="@{/}">항공 예약하고 오기</a></div>
        </div>
        <div th:unless="${flightInfo == null}" class="">
            <div class="flightPriceBox" >
                <div class="flightPriceRoute" th:text="|${flightInfo.routes[0].departureAirport} &#x2192; ${flightInfo.routes[0].arrivalAirport}|"></div>
                    <div class="flight-box-wrapper">
                        <div class="departMain">
                            <span class="mainDate" th:text="${flightInfo.departureDate}"></span>
                            <img class="mainAirlineImage" th:src="${flightInfo.routes[0].airlineImg}">
                            <table><tr>
                                <td><div class="depart">
                                    <span th:text="${flightInfo.routes[0].departureTime}"></span>
                                    <span th:text="${flightInfo.routes[0].departureAirport}"></span>
                                </div></td>
                                <td><div class="center-content">
                                    <span class="duration" th:text="${flightInfo.routes[0].duration}"></span><img src="/img/flight/plane.png">
                                </div></td>
                                <td><div class="arrive">
                                    <span th:text="${flightInfo.routes[0].arrivalTime}"></span>
                                    <span th:text="${flightInfo.routes[0].arrivalAirport}"></span>
                                </div></td>
                            </tr></table>
                        </div>
                        <div class="departMain">
                            <span class="mainDate" th:text="${flightInfo.arrivalDate}"></span>
                            <img class="mainAirlineImage" th:src="${flightInfo.routes[1].airlineImg}">
                            <table><tr>
                                <td><div class="depart">
                                    <span th:text="${flightInfo.routes[1].departureTime}"></span>
                                    <span th:text="${flightInfo.routes[1].departureAirport}"></span>
                                </div></td>
                                <td><div class="center-content">
                                    <span class="duration" th:text="${flightInfo.routes[1].duration}"></span><img src="/img/flight/plane.png">
                                </div></td>
                                <td><div class="arrive">
                                    <span th:text="${flightInfo.routes[1].arrivalTime}"></span>
                                    <span th:text="${flightInfo.routes[1].arrivalAirport}"></span>
                                </div></td>
                            </tr></table>
                        </div>
                    </div>
                    <div class="amountBox">
                        <span>항공기 이용권 : </span><span class="amount" th:text="| ₩${flightInfo.price}|"></span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
</body>
</html>